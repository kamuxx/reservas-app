<div class="p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Gestión de Espacios</h1>
      <p class="text-gray-600 mt-1">Administra los espacios disponibles para reservas</p>
    </div>
    <div class="flex space-x-3">
      <p-button label="Nuevo Espacio"
                icon="pi pi-plus"
                (click)="openNewSpaceDialog()">
      </p-button>
      <p-button label="Recargar"
                icon="pi pi-refresh"
                (click)="loadSpaces()"
                [loading]="loading">
      </p-button>
    </div>
  </div>

  <!-- Table Implementation -->
  <p-table [value]="spaces"
             [loading]="loading"
             [rows]="10"
             [paginator]="true"
             [rowsPerPageOptions]="[10, 25, 50]"
             [globalFilterFields]="['name']"
             [responsive]="true"
             class="p-datatable-sm">
    
    <!-- ID Column -->
    <ng-template pTemplate="header" let-col>
      <span class="font-semibold">{{ col.header }}</span>
    </ng-template>

    <ng-template pTemplate="body" let-space let-col="col">
      <span *ngIf="col.field === 'uuid'" class="text-xs text-gray-500">
        {{ space.uuid?.split('-')[0]?.toUpperCase() }}
      </span>
    </ng-template>

    <!-- Name Column -->
    <ng-template pTemplate="body" let-space let-col="col">
      <span *ngIf="col.field === 'name'" class="font-medium text-gray-900">
        {{ space.name }}
      </span>
    </ng-template>

    <!-- Type Column -->
    <ng-template pTemplate="body" let-space let-col="col">
      <span *ngIf="col.field === 'type'" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
        <i class="pi pi-tag mr-1"></i>
        {{ space.type?.name || 'Sin tipo' }}
      </span>
    </ng-template>

    <!-- Capacity Column -->
    <ng-template pTemplate="body" let-space let-col="col">
      <div *ngIf="col.field === 'capacity'" class="flex items-center">
        <i class="pi pi-users mr-2 text-gray-400"></i>
        <span class="font-medium">{{ space.capacity }} personas</span>
      </div>
    </ng-template>

    <!-- Status Column -->
    <ng-template pTemplate="body" let-space let-col="col">
      <span *ngIf="col.field === 'is_active'" 
            [class]="'p-tag ' + getStatusBadgeClass(space.is_active)">
        <i [class]="'pi ' + getStatusIcon(space.is_active) + ' mr-1'"></i>
        {{ getStatusText(space.is_active) }}
      </span>
    </ng-template>

    <!-- Actions Column -->
    <ng-template pTemplate="body" let-space let-col="col">
      <div *ngIf="col.field === 'actions'" class="flex space-x-2">
        <p-button icon="pi pi-pencil"
                  [class]="'p-button-rounded p-button-text p-button-info'"
                  pTooltip="Editar"
                  (click)="openEditSpaceDialog(space)">
        </p-button>
        
        <p-button icon="pi pi-power-off"
                  [class]="space.is_active ? 'p-button-rounded p-button-text p-button-warning' : 'p-button-rounded p-button-text p-button-success'"
                  pTooltip="{{ space.is_active ? 'Desactivar' : 'Activar' }}"
                  (click)="confirmDelete(space)">
        </p-button>
        
        <p-button icon="pi pi-trash"
                  [class]="'p-button-rounded p-button-text p-button-danger'"
                  pTooltip="Eliminar"
                  (click)="confirmDelete(space)">
        </p-button>
      </div>
    </ng-template>

    <!-- Empty Template -->
    <ng-template pTemplate="empty">
      <div class="text-center py-8">
        <i class="pi pi-building text-4xl text-gray-400 mb-4"></i>
        <p class="text-gray-600 text-lg font-medium">No hay espacios registrados</p>
        <p class="text-gray-500">Crea tu primer espacio para comenzar</p>
      </div>
    </ng-template>
  </p-table>

  <!-- Simple Dialog -->
  <p-dialog [header]="spaceDialogHeader"
             [(visible)]="spaceDialog"
             [modal]="true"
             [style]="{ width: '600px' }">
    
    <form (ngSubmit)="saveSpace()" class="p-4 space-y-4">
      <div>
        <label for="spaceName" class="block text-sm font-medium text-gray-700 mb-2">
          Nombre del Espacio
        </label>
        <input pInputText id="spaceName"
                     [(ngModel)]="currentSpace.name"
                     placeholder="Ej: Sala de Conferencias A"
                     class="w-full">
      </div>

      <div>
        <label for="spaceDescription" class="block text-sm font-medium text-gray-700 mb-2">
          Descripción
        </label>
        <textarea pInputTextarea id="spaceDescription"
                     [(ngModel)]="currentSpace.description"
                     rows="3"
                     placeholder="Describe el espacio, sus características y equipamiento..."
                     class="w-full">
        </textarea>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="spaceCapacity" class="block text-sm font-medium text-gray-700 mb-2">
            Capacidad
          </label>
          <p-inputNumber id="spaceCapacity"
                       [(ngModel)]="currentSpace.capacity"
                       [min]="1"
                       placeholder="Personas"
                       class="w-full">
          </p-inputNumber>
        </div>

        <div>
          <label for="spaceStatus" class="block text-sm font-medium text-gray-700 mb-2">
            Estado
          </label>
          <p-dropdown id="spaceStatus"
                     [(ngModel)]="currentSpace.is_active"
                     [options]="[{label: 'Activo', value: true}, {label: 'Inactivo', value: false}]"
                     optionLabel="label"
                     optionValue="value"
                     placeholder="Selecciona un estado"
                     class="w-full">
          </p-dropdown>
        </div>
      </div>

      <!-- Dialog Actions -->
      <div class="flex justify-end space-x-3 pt-4 border-t">
        <p-button label="Cancelar"
                  type="button"
                  icon="pi pi-times"
                  (click)="hideDialog()"
                  class="p-button-text">
        </p-button>
        <p-button label="Guardar"
                  type="submit"
                  icon="pi pi-check"
                  [loading]="loading">
        </p-button>
      </div>
    </form>
  </p-dialog>

  <!-- Confirm Dialog -->
  <p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>

  <!-- Toast Messages -->
  <p-toast position="top-right"></p-toast>
</div>